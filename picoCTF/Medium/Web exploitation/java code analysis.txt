Author: Tony_29
Category: Web Exploitation 
Challenge :Java code analysis 
Difficulty:  Medium 

Description

BookShelf Pico, my premium online book-reading service. I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book! Here are the credentials to get you started:

    Username: "user"
    Password: "user"

Source code can be downloaded here. Website can be accessed here!.

Objective :

To find a way to read the flag book by taking the permissions of the admin

Walkthrough

Step 1 — Initial Analysis

 After logging into the website with the given credentials ,I saw three books 
 One book is named as flag and when I tried to open the book it was responding with a message "only the admin can access"
 The current role that is given is a free tire 
 We need admin access to read the flag book
Step 2 — Investigation / Enumeration

 Logged out and initiated login once again but this time the burp interceptor is on to analyse the login request
 Captured the login request only the user name and password is supplied to the server
 Tried to intercept the response made by this login request ,to my surprise there was a jwt token sending along with the response 
 Copied the jwt token and decoded it with the help of jwt.io, it was holding the key information
  {
   "role": "Free",
   "iss": "bookshelf",
   "exp": 1763894474,
   "iat": 1763289674,
   "userId": 1,
   "email": "user"
  }
 Tried to modify the values and forge a new jwt token , but to do that I need the secret key thanks to the source code by digging into the source files I found the secret key it was "1234"

Step 3 — Exploitation 

 with the help of the jwt token body and secret key forged a new jwt token but with the admin role 
  {
   "role": "admin",
   "iss": "bookshelf",
   "exp": 1763897780,
   "iat": 1763292981,
   "userId": 2,
   "email": "admin"
  }
 Went back to the response that was made by the login request and replaced the newly generated jwt token, and sent to the browser

Step 4 — Retrieve the Flag

 The browser opened a admin session ,Navigated to the flag book pdf and opened it found the flag 


Flag :

picoCTF{w34k_jwt_n0t_g00d_d7c2e335}